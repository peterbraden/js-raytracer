<html>
	<head>
		<script src = 'http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js'></script>
		<script src = './plib.js'></script>
		<script src = './raytracer.js'></script>
    <script src= './setimmediate.js'></script>
		<style type = 'text/css'>
body{background-color:#eee;font-family:'Gill sans', helvetica, arial, sans; text-align:center;}
p{width:40em; margin: 0 auto;}
		</style>
	</head>
	<body>
<h1>Tracing Rays</h1>	


<canvas id = "rays" width = "900" height = "500">
This only works in a modern browser that supports the &lt;canvas&gt; element. For example Firefox 3.5+, Safari or Chrome.
</canvas>

<br />
<button id = "start_raytracer">Start</button>
<br />

<p><em>The raytracer is pretty processor intensive - I recommend you run it in Google Chrome which has the fastest javascript engine I've found. Also tested in Firefox/Safari. Will certainly not work in IE.</em></p>



<script type = "text/javascript">


/** Scene Params **/
rays.eye = [0,0,0];
rays.cam_dist = 200; /* Cam plane is x,y,cam_dist */
rays.ambient = 0.1;
rays.max_depth = 1;
rays.antialias = 4;//Num samples

rays.scene = {}
rays.scene.objects = [

	new rays.Sphere([7, 5, 5], 5.0, [0xff,0,0], 20,  0.2)
,	new rays.Sphere([0,5,12], 5, [0,0,0xff], 20, 0.2)
, new rays.Sphere([-7 , 5, 5], 5.0, [0x00,0xff,0x00], 30, 0.2)

, new rays.Sphere([-10 , 2, 0], 2.0, [0xff,0xff,0xff], 30, 0.5)
, new rays.Sphere([10 , 2, 0], 2.0, [0xff,0xff,0xff], 30, 0.5)

, new rays.SkyDome()

, new rays.CheckerYPlane(0.0, [0x33,0x33,0x33], [0xdd,0xdd,0xdd])

	];
rays.scene.lights = [
/*	 [[x,y,z], intensity(0-1), color] */
	[[-300,300,0], 0.6, [0xff, 0xff, 0xff]]
,	[[300,300,0], 0.2, [0xff, 0xff, 0 ]]
]
rays.scene.camera = new rays.Camera([0.0,10.0,-50.0], [0.0,5.0,0.0], Math.PI/4, 5, 4);


/** Onload setup the canvas and do shizzle **/
$(function(){
	var screen = $("#rays")[0];
	var ctx = screen.getContext('2d');

	ctx.fillStyle = "#555";
	ctx.fillRect (0, 0, screen.width, screen.height);

  rays.imdat = ctx.getImageData(0, 0, screen.width, screen.height)
  rays.width = screen.width
  rays.height = screen.height

  rays.renderLine = function(y){
  console.log("RENDER ", y)
    //ctx.putImageData(rays.imdat, 0, 0, 0, y, rays.width, 1)
    ctx.putImageData(rays.imdat, 0, 0)
  }

	$("#start_raytracer").click(function(){
    rays.start(0, 0, rays.width, rays.height)
	});

});
</script>

	</body>	
</html>	
